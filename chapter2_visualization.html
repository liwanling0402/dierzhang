<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第二章数据可视化 - 交互式图表展示</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .dataset-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .dataset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .dataset-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .dataset-card:hover {
            transform: translateY(-5px);
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .dataset-card.active {
            border-color: #667eea;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }
        
        .dataset-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .dataset-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .dataset-desc {
            font-size: 0.9rem;
            color: #7f8c8d;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 1.5rem;
            color: #2c3e50;
        }
        
        .chart-controls {
            display: flex;
            gap: 10px;
        }
        
        .chart-type-btn {
            padding: 8px 15px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chart-type-btn.active {
            background: #667eea;
            color: white;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        
        canvas {
            width: 100% !important;
            height: 100% !important;
        }
        
        .data-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
            color: #7f8c8d;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>第二章数据可视化平台</h1>
            <p class="subtitle">基于《数据可视化》第二章内容的交互式图表展示</p>
        </header>
        
        <div class="dataset-selector">
            <h2>选择数据集</h2>
            <div class="dataset-grid" id="datasetGrid">
                <!-- 数据集卡片将通过JavaScript动态生成 -->
            </div>
        </div>
        
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title" id="chartTitle">请选择数据集开始可视化</h2>
                <div class="chart-controls" id="chartControls" style="display: none;">
                    <button class="chart-type-btn active" data-type="line">折线图</button>
                    <button class="chart-type-btn" data-type="bar">柱状图</button>
                    <button class="chart-type-btn" data-type="pie">饼图</button>
                    <button class="chart-type-btn" data-type="radar">雷达图</button>
                </div>
            </div>
            
            <div class="chart-wrapper">
                <canvas id="mainChart"></canvas>
            </div>
            
            <div class="data-info" id="dataInfo">
                共 0 条数据 | 当前图表类型: 未选择
            </div>
        </div>
    </div>

    <script>
        // 第二章数据集
        const chapter2Data = {
            temperatureData: {
                title: '未来15天最高气温和最低气温',
                description: '展示未来15天的最高气温和最低气温变化趋势',
                data: [
                    { day: 4, maxTemp: 32, minTemp: 19 },
                    { day: 5, maxTemp: 33, minTemp: 19 },
                    { day: 6, maxTemp: 34, minTemp: 20 },
                    { day: 7, maxTemp: 34, minTemp: 22 },
                    { day: 8, maxTemp: 33, minTemp: 22 },
                    { day: 9, maxTemp: 31, minTemp: 21 },
                    { day: 10, maxTemp: 30, minTemp: 22 },
                    { day: 11, maxTemp: 29, minTemp: 16 },
                    { day: 12, maxTemp: 30, minTemp: 18 },
                    { day: 13, maxTemp: 29, minTemp: 18 },
                    { day: 14, maxTemp: 26, minTemp: 17 },
                    { day: 15, maxTemp: 23, minTemp: 14 },
                    { day: 16, maxTemp: 21, minTemp: 15 },
                    { day: 17, maxTemp: 25, minTemp: 16 },
                    { day: 18, maxTemp: 31, minTemp: 16 }
                ]
            },
            
            alibabaGMVData: {
                title: '2013-2019财年阿里巴巴淘宝和天猫平台GMV',
                description: '展示阿里巴巴电商平台年度交易总额(GMV)的增长趋势',
                data: [
                    { year: 'FY2013', gmv: 10770 },
                    { year: 'FY2014', gmv: 16780 },
                    { year: 'FY2015', gmv: 24440 },
                    { year: 'FY2016', gmv: 30920 },
                    { year: 'FY2017', gmv: 37670 },
                    { year: 'FY2018', gmv: 48200 },
                    { year: 'FY2019', gmv: 57270 }
                ]
            },
            
            onlineShoppingRateData: {
                title: '各商品种类的网购替代率',
                description: '展示不同商品种类在网购中的替代率',
                data: [
                    { category: '家政服务', rate: 0.959 },
                    { category: '机票火车票', rate: 0.951 },
                    { category: '家具', rate: 0.935 },
                    { category: '手机配件', rate: 0.924 },
                    { category: '计算机产品', rate: 0.893 },
                    { category: '汽车用品', rate: 0.892 },
                    { category: '通信充值', rate: 0.865 },
                    { category: '个人护理', rate: 0.863 },
                    { category: '书报杂志', rate: 0.860 },
                    { category: '餐饮旅游', rate: 0.856 },
                    { category: '家用电器', rate: 0.854 },
                    { category: '食品饮料', rate: 0.835 },
                    { category: '家庭日杂', rate: 0.826 },
                    { category: '保险票务', rate: 0.816 },
                    { category: '服装鞋帽', rate: 0.798 },
                    { category: '数码产品', rate: 0.765 },
                    { category: '其他服务', rate: 0.763 },
                    { category: '工艺品', rate: 0.670 }
                ]
            },
            
            carSpeedBrakingData: {
                title: '汽车速度与制动距离的关系',
                description: '展示汽车在不同速度下的制动距离关系',
                data: [
                    { speed: 10, distance: 0.5 },
                    { speed: 20, distance: 2.0 },
                    { speed: 30, distance: 4.4 },
                    { speed: 40, distance: 7.9 },
                    { speed: 50, distance: 12.3 },
                    { speed: 60, distance: 17.7 },
                    { speed: 70, distance: 24.1 },
                    { speed: 80, distance: 31.5 },
                    { speed: 90, distance: 39.9 },
                    { speed: 100, distance: 49.2 },
                    { speed: 110, distance: 59.5 },
                    { speed: 120, distance: 70.8 },
                    { speed: 130, distance: 83.1 },
                    { speed: 140, distance: 96.4 },
                    { speed: 150, distance: 110.7 },
                    { speed: 160, distance: 126.0 },
                    { speed: 170, distance: 142.2 },
                    { speed: 180, distance: 159.4 },
                    { speed: 190, distance: 177.6 },
                    { speed: 200, distance: 196.8 }
                ]
            },
            
            logisticsCostData: {
                title: '物流公司物流费用统计',
                description: '展示三家物流公司各月的物流费用统计',
                data: [
                    { month: '1月', companyA: 198, companyB: 203, companyC: 185 },
                    { month: '2月', companyA: 215, companyB: 236, companyC: 205 },
                    { month: '3月', companyA: 245, companyB: 200, companyC: 226 },
                    { month: '4月', companyA: 222, companyB: 236, companyC: 199 },
                    { month: '5月', companyA: 200, companyB: 269, companyC: 238 },
                    { month: '6月', companyA: 236, companyB: 216, companyC: 200 },
                    { month: '7月', companyA: 201, companyB: 298, companyC: 250 },
                    { month: '8月', companyA: 253, companyB: 333, companyC: 209 },
                    { month: '9月', companyA: 236, companyB: 301, companyC: 246 },
                    { month: '10月', companyA: 200, companyB: 349, companyC: 219 },
                    { month: '11月', companyA: 266, companyB: 360, companyC: 253 },
                    { month: '12月', companyA: 290, companyB: 368, companyC: 288 }
                ]
            }
        };

        // 图表实例和当前状态
        let currentChart = null;
        let currentDataset = null;
        let currentChartType = 'line';

        // 初始化页面
        function initPage() {
            renderDatasetCards();
            setupChartControls();
        }

        // 渲染数据集卡片
        function renderDatasetCards() {
            const grid = document.getElementById('datasetGrid');
            grid.innerHTML = '';
            
            Object.entries(chapter2Data).forEach(([key, dataset]) => {
                const card = document.createElement('div');
                card.className = 'dataset-card';
                card.innerHTML = `
                    <div class="dataset-icon">${getDatasetIcon(key)}</div>
                    <div class="dataset-title">${dataset.title}</div>
                    <div class="dataset-desc">${dataset.description}</div>
                `;
                card.addEventListener('click', () => selectDataset(key, dataset));
                grid.appendChild(card);
            });
        }

        // 获取数据集图标
        function getDatasetIcon(datasetKey) {
            const icons = {
                temperatureData: '🌡️',
                alibabaGMVData: '💰',
                onlineShoppingRateData: '🛒',
                carSpeedBrakingData: '🚗',
                logisticsCostData: '🚚'
            };
            return icons[datasetKey] || '📊';
        }

        // 选择数据集
        function selectDataset(key, dataset) {
            currentDataset = { key, ...dataset };
            
            // 更新UI状态
            document.querySelectorAll('.dataset-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            document.getElementById('chartTitle').textContent = dataset.title;
            document.getElementById('chartControls').style.display = 'flex';
            document.getElementById('dataInfo').textContent = 
                `共 ${dataset.data.length} 条数据 | 当前图表类型: ${currentChartType}`;
            
            // 根据数据类型自动选择图表类型
            if (key === 'onlineShoppingRateData') {
                currentChartType = 'bar';
            } else if (key === 'logisticsCostData') {
                currentChartType = 'line';
            } else {
                currentChartType = 'line';
            }
            
            updateChartTypeButtons();
            renderChart();
        }

        // 设置图表类型控制
        function setupChartControls() {
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    currentChartType = e.target.dataset.type;
                    updateChartTypeButtons();
                    renderChart();
                });
            });
        }

        // 更新图表类型按钮状态
        function updateChartTypeButtons() {
            document.querySelectorAll('.chart-type-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === currentChartType);
            });
        }

        // 渲染图表
        function renderChart() {
            if (!currentDataset) return;
            
            const ctx = document.getElementById('mainChart').getContext('2d');
            
            // 销毁现有图表
            if (currentChart) {
                currentChart.destroy();
            }
            
            const config = getChartConfig(currentDataset, currentChartType);
            currentChart = new Chart(ctx, config);
            
            // 更新数据信息
            document.getElementById('dataInfo').textContent = 
                `共 ${currentDataset.data.length} 条数据 | 当前图表类型: ${getChartTypeName(currentChartType)}`;
        }

        // 获取图表配置
        function getChartConfig(dataset, chartType) {
            const commonConfig = {
                responsive: true,
                maintainAspectRatio: false,
            };
            
            switch (chartType) {
                case 'line':
                    return getLineChartConfig(dataset, commonConfig);
                case 'bar':
                    return getBarChartConfig(dataset, commonConfig);
                case 'pie':
                    return getPieChartConfig(dataset, commonConfig);
                case 'radar':
                    return getRadarChartConfig(dataset, commonConfig);
                default:
                    return getLineChartConfig(dataset, commonConfig);
            }
        }

        // 获取折线图配置
        function getLineChartConfig(dataset, commonConfig) {
            const labels = dataset.data.map(item => item.day || item.speed || item.month || item.year);
            const datasets = [];
            
            if (dataset.key === 'temperatureData') {
                datasets.push({
                    label: '最高气温',
                    data: dataset.data.map(item => item.maxTemp),
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    tension: 0.4
                });
                datasets.push({
                    label: '最低气温',
                    data: dataset.data.map(item => item.minTemp),
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    tension: 0.4
                });
            } else if (dataset.key === 'logisticsCostData') {
                datasets.push({
                    label: '公司A',
                    data: dataset.data.map(item => item.companyA),
                    borderColor: '#FF6B6B',
                    backgroundColor: 'rgba(255, 107, 107, 0.1)',
                    tension: 0.4
                });
                datasets.push({
                    label: '公司B',
                    data: dataset.data.map(item => item.companyB),
                    borderColor: '#4ECDC4',
                    backgroundColor: 'rgba(78, 205, 196, 0.1)',
                    tension: 0.4
                });
                datasets.push({
                    label: '公司C',
                    data: dataset.data.map(item => item.companyC),
                    borderColor: '#45B7D1',
                    backgroundColor: 'rgba(69, 183, 209, 0.1)',
                    tension: 0.4
                });
            } else {
                datasets.push({
                    label: dataset.key === 'carSpeedBrakingData' ? '制动距离' : 'GMV',
                    data: dataset.data.map(item => item.distance || item.gmv),
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4
                });
            }
            
            return {
                ...commonConfig,
                type: 'line',
                data: { labels, datasets },
                options: {
                    ...commonConfig.options,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        // 获取柱状图配置
        function getBarChartConfig(dataset, commonConfig) {
            const labels = dataset.data.map(item => item.category || item.year);
            const data = dataset.data.map(item => item.rate || item.gmv);
            
            return {
                ...commonConfig,
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: dataset.key === 'onlineShoppingRateData' ? '替代率' : 'GMV',
                        data,
                        backgroundColor: 'rgba(102, 126, 234, 0.8)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    ...commonConfig.options,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        // 获取饼图配置
        function getPieChartConfig(dataset, commonConfig) {
            const labels = dataset.data.map(item => item.category || item.year);
            const data = dataset.data.map(item => item.rate || item.gmv);
            
            return {
                ...commonConfig,
                type: 'pie',
                data: {
                    labels,
                    datasets: [{
                        data,
                        backgroundColor: [
                            '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
                            '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
                        ]
                    }]
                }
            };
        }

        // 获取雷达图配置
        function getRadarChartConfig(dataset, commonConfig) {
            // 简化实现，使用折线图代替
            return getLineChartConfig(dataset, commonConfig);
        }

        // 获取图表类型名称
        function getChartTypeName(type) {
            const names = {
                line: '折线图',
                bar: '柱状图',
                pie: '饼图',
                radar: '雷达图'
            };
            return names[type] || type;
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>
</html>