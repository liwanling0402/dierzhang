<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第二章真实数据可视化平台 - 022340611.xyz</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white; min-height: 100vh; line-height: 1.6;
        }
        .header {
            background: rgba(255,255,255,0.1); 
            padding: 30px 0; text-align: center;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; color: #4ecdc4; }
        .header p { font-size: 1.2rem; opacity: 0.8; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .controls { 
            background: rgba(255,255,255,0.05); 
            padding: 25px; border-radius: 15px; 
            margin-bottom: 25px; backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        .data-selector { margin-bottom: 20px; }
        .data-selector label { display: block; margin-bottom: 10px; font-weight: bold; font-size: 1.1rem; }
        .data-buttons { display: flex; gap: 10px; flex-wrap: wrap; }
        .data-btn { 
            background: #4ecdc4; border: none; color: white; 
            padding: 12px 20px; border-radius: 8px; cursor: pointer; 
            font-size: 14px; transition: all 0.3s ease; font-weight: 500;
        }
        .data-btn:hover { background: #45b7d1; transform: translateY(-2px); }
        .data-btn.active { background: #ff6b6b; box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4); }
        .chart-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px; }
        .chart-btn { 
            background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            color: white; padding: 10px 15px; border-radius: 6px; 
            cursor: pointer; font-size: 14px; transition: all 0.3s ease;
            font-weight: 500;
        }
        .chart-btn:hover { background: rgba(255,255,255,0.2); }
        .chart-btn.active { background: #4ecdc4; border-color: #4ecdc4; }
        .chart-container { 
            background: rgba(255,255,255,0.05); 
            padding: 25px; border-radius: 15px; 
            margin-bottom: 25px; backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        canvas { width: 100% !important; height: 500px !important; }
        .chart-info { 
            margin-top: 20px; padding: 15px; 
            background: rgba(255,255,255,0.05); 
            border-radius: 8px; font-size: 14px; 
            border-left: 4px solid #4ecdc4;
        }
        .data-preview { 
            background: rgba(255,255,255,0.05); 
            padding: 15px; border-radius: 8px; 
            margin-top: 15px; max-height: 200px; overflow-y: auto;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .loading { text-align: center; padding: 20px; color: #4ecdc4; font-size: 1.1rem; }
        .data-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .data-table th, .data-table td { 
            padding: 8px; text-align: left; 
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .data-table th { background: rgba(255,255,255,0.1); font-weight: 600; }
        .status-bar { 
            background: rgba(255,255,255,0.05); 
            padding: 10px 15px; border-radius: 6px; 
            margin-top: 10px; font-size: 12px; opacity: 0.8;
        }
        .footer {
            text-align: center; padding: 20px; 
            opacity: 0.6; font-size: 12px;
            border-top: 1px solid rgba(255,255,255,0.1);
            margin-top: 30px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>第二章真实数据可视化平台</h1>
        <p>基于实际CSV数据的交互式可视化分析 - 部署版本</p>
        <div class="status-bar" id="statusBar">平台已就绪，等待数据加载...</div>
    </div>

    <div class="container">
        <div class="controls">
            <div class="data-selector">
                <label>选择数据集：</label>
                <div class="data-buttons">
                    <button class="data-btn active" onclick="loadDataset('temperature')">🌡️ 温度数据</button>
                    <button class="data-btn" onclick="loadDataset('alibaba')">💰 阿里巴巴GMV数据</button>
                    <button class="data-btn" onclick="loadDataset('shopping')">🛒 网购替代率数据</button>
                    <button class="data-btn" onclick="loadDataset('logistics')">🚚 物流费用数据</button>
                    <button class="data-btn" onclick="loadDataset('car')">🚗 汽车制动数据</button>
                    <button class="data-btn" onclick="loadDataset('power')">⚡ 发电量数据</button>
                    <button class="data-btn" onclick="loadDataset('holland')">🧠 霍兰德测试数据</button>
                    <button class="data-btn" onclick="loadDataset('biomass')">🌳 细根生物量数据</button>
                </div>
            </div>
            
            <div class="chart-buttons">
                <button class="chart-btn active" onclick="showChart('scatter')">📊 散点图</button>
                <button class="chart-btn" onclick="showChart('bar')">📈 柱状图</button>
                <button class="chart-btn" onclick="showChart('line')">📉 折线图</button>
                <button class="chart-btn" onclick="showChart('pie')">🥧 饼图</button>
                <button class="chart-btn" onclick="showChart('histogram')">📋 直方图</button>
                <button class="chart-btn" onclick="showChart('radar')">🎯 雷达图</button>
                <button class="chart-btn" onclick="showChart('bubble')">🫧 气泡图</button>
            </div>
        </div>

        <div class="chart-container">
            <div id="loading" class="loading">正在加载数据...</div>
            <canvas id="myChart"></canvas>
            <div class="chart-info" id="chartInfo"></div>
            <div class="data-preview" id="dataPreview"></div>
        </div>
    </div>

    <div class="footer">
        部署版本 | 数据可视化平台 | http://022340611.xyz/ | 最后更新: 2025/10/17
    </div>

    <script>
        let currentChart = null;
        let currentDataset = null;
        let currentDataType = 'temperature';
        
        // 颜色配置
        const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'];
        
        // 第二章数据集描述
        const datasetInfo = {
            temperature: {
                name: '未来15天温度数据',
                description: '展示未来15天的最高气温和最低气温变化趋势',
                file: './素材/温度数据.csv'
            },
            alibaba: {
                name: '阿里巴巴GMV数据',
                description: '2013-2019财年阿里巴巴淘宝和天猫平台GMV数据',
                file: './素材/阿里巴巴GMV数据.csv'
            },
            shopping: {
                name: '网购替代率数据',
                description: '各商品种类的网购替代率统计分析',
                file: './素材/网购替代率数据.csv'
            },
            logistics: {
                name: '物流费用数据',
                description: '三家物流公司各月的物流费用统计',
                file: './素材/物流费用数据.csv'
            },
            car: {
                name: '汽车制动数据',
                description: '汽车速度与制动距离的关系数据',
                file: './素材/汽车制动数据.csv'
            },
            power: {
                name: '发电量数据',
                description: '2017年和2018年全国发电量统计对比',
                file: './素材/发电量数据.csv'
            },
            holland: {
                name: '霍兰德测试数据',
                description: '霍兰德职业兴趣测试的六个维度得分',
                file: './素材/霍兰德测试数据.csv'
            },
            biomass: {
                name: '细根生物量数据',
                description: '4个树种不同季节的细根生物量统计',
                file: './素材/细根生物量数据.csv'
            }
        };
        
        // 图表类型描述
        const chartDescriptions = {
            scatter: "散点图 - 显示两个连续变量之间的关系，适合相关性分析",
            bar: "柱状图 - 比较不同类别的数值大小，适合分类数据对比",
            line: "折线图 - 显示数据随时间或其他连续变量的趋势变化",
            pie: "饼图 - 显示各部分占整体的比例关系",
            histogram: "直方图 - 显示数据分布频率，分析数据分布特征",
            radar: "雷达图 - 多维数据对比分析，展示综合表现",
            bubble: "气泡图 - 三个维度的数据可视化，气泡大小表示第三个变量"
        };

        // 更新状态栏
        function updateStatus(message) {
            document.getElementById('statusBar').textContent = message;
        }

        // 加载数据集
        function loadDataset(type, event) {
            currentDataType = type;
            document.querySelectorAll('.data-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('myChart').style.display = 'none';
            updateStatus(`正在加载 ${datasetInfo[type].name}...`);
            
            const filePath = datasetInfo[type].file;
            Papa.parse(filePath, {
                download: true,
                header: true,
                complete: function(results) {
                    if (results.errors.length > 0) {
                        console.warn('解析警告:', results.errors);
                        updateStatus(`数据加载完成，有 ${results.errors.length} 个警告`);
                    }
                    
                    currentDataset = results.data.filter(row => {
                        // 过滤空行
                        return Object.values(row).some(value => value && value.trim() !== '');
                    });
                    
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('myChart').style.display = 'block';
                    updateStatus(`${datasetInfo[type].name} 加载成功，共 ${currentDataset.length} 条记录`);
                    
                    // 显示数据预览
                    showDataPreview();
                    
                    // 默认显示散点图
                    showChart('scatter');
                },
                error: function(error) {
                    console.error('数据加载错误:', error);
                    document.getElementById('loading').innerHTML = 
                        '数据加载失败，请检查文件路径或网络连接<br>错误信息: ' + error.message;
                    updateStatus('数据加载失败: ' + error.message);
                }
            });
        }

        // 显示数据预览
        function showDataPreview() {
            const preview = document.getElementById('dataPreview');
            if (!currentDataset || currentDataset.length === 0) {
                preview.innerHTML = '<p>无数据可显示</p>';
                return;
            }
            
            const headers = Object.keys(currentDataset[0]);
            let html = `<h4>📋 数据预览 (前5行)</h4>`;
            html += `<table class="data-table">`;
            html += `<tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr>`;
            
            currentDataset.slice(0, 5).forEach(row => {
                html += `<tr>${headers.map(h => `<td>${row[h] || ''}</td>`).join('')}</tr>`;
            });
            
            html += `</table>`;
            html += `<p>总记录数: ${currentDataset.length} | 列数: ${headers.length}</p>`;
            preview.innerHTML = html;
        }

        // 显示图表
        function showChart(type) {
            if (!currentDataset || currentDataset.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>无数据可显示图表，请检查数据文件</strong>';
                return;
            }
            
            // 更新按钮状态
            document.querySelectorAll('.chart-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // 更新图表描述
            document.getElementById('chartInfo').innerHTML = 
                `<strong>${chartDescriptions[type]}</strong><br>数据集: ${datasetInfo[currentDataType].name}`;
            
            // 销毁现有图表
            if (currentChart) {
                currentChart.destroy();
            }
            
            const ctx = document.getElementById('myChart').getContext('2d');
            updateStatus(`正在生成 ${type} 图表...`);
            
            try {
                switch(type) {
                    case 'scatter':
                        createScatterChart(ctx);
                        break;
                    case 'bar':
                        createBarChart(ctx);
                        break;
                    case 'line':
                        createLineChart(ctx);
                        break;
                    case 'pie':
                        createPieChart(ctx);
                        break;
                    case 'histogram':
                        createHistogramChart(ctx);
                        break;
                    case 'radar':
                        createRadarChart(ctx);
                        break;
                    case 'bubble':
                        createBubbleChart(ctx);
                        break;
                }
                updateStatus(`${type} 图表生成成功`);
            } catch (error) {
                console.error('图表创建错误:', error);
                document.getElementById('chartInfo').innerHTML = 
                    `<strong>图表创建失败: ${error.message}</strong>`;
                updateStatus(`图表创建失败: ${error.message}`);
            }
        }

        // 创建散点图
        function createScatterChart(ctx) {
            let xData, yData, label, xLabel, yLabel;
            
            if (currentDataType === 'temperature') {
                xData = currentDataset.map(d => parseFloat(d.day));
                yData = currentDataset.map(d => parseFloat(d.maxTemp));
                label = '天数 vs 最高温度';
                xLabel = '天数';
                yLabel = '最高温度 (°C)';
            } else if (currentDataType === 'alibaba') {
                xData = currentDataset.map(d => parseInt(d.year.replace('FY', '')));
                yData = currentDataset.map(d => parseFloat(d.gmv));
                label = '年份 vs GMV';
                xLabel = '年份';
                yLabel = 'GMV (亿元)';
            } else if (currentDataType === 'shopping') {
                xData = currentDataset.map((_, i) => i + 1);
                yData = currentDataset.map(d => parseFloat(d.rate));
                label = '商品种类 vs 替代率';
                xLabel = '商品种类序号';
                yLabel = '网购替代率';
            } else if (currentDataType === 'car') {
                xData = currentDataset.map(d => parseFloat(d.speed));
                yData = currentDataset.map(d => parseFloat(d.distance));
                label = '速度 vs 制动距离';
                xLabel = '速度 (km/h)';
                yLabel = '制动距离 (m)';
            } else {
                // 默认使用第一个数值列和第二个数值列
                const headers = Object.keys(currentDataset[0] || {});
                const numericHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return !isNaN(parseFloat(val)) && val !== '';
                });
                
                if (numericHeaders.length >= 2) {
                    xData = currentDataset.map(d => parseFloat(d[numericHeaders[0]]));
                    yData = currentDataset.map(d => parseFloat(d[numericHeaders[1]]));
                    label = `${numericHeaders[0]} vs ${numericHeaders[1]}`;
                    xLabel = numericHeaders[0];
                    yLabel = numericHeaders[1];
                } else {
                    xData = currentDataset.map((_, i) => i);
                    yData = currentDataset.map(d => parseFloat(Object.values(d)[0] || 0));
                    label = '序号 vs 数值';
                    xLabel = '序号';
                    yLabel = '数值';
                }
            }
            
            // 过滤无效数据
            const validData = xData.map((x, i) => ({x: x, y: yData[i]}))
                .filter(point => !isNaN(point.x) && !isNaN(point.y));
            
            currentChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [{
                        label: label,
                        data: validData,
                        backgroundColor: colors[0],
                        pointRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        },
                        y: { 
                            title: { display: true, text: yLabel },
                            grid: { color: 'rgba(255,255,255,0.1)' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // 创建柱状图
        function createBarChart(ctx) {
            let labels, data, label;
            
            if (currentDataType === 'temperature') {
                labels = currentDataset.map(d => `第${d.day}天`);
                data = currentDataset.map(d => parseFloat(d.maxTemp));
                label = '每日最高温度';
            } else if (currentDataType === 'alibaba') {
                labels = currentDataset.map(d => d.year);
                data = currentDataset.map(d => parseFloat(d.gmv) / 1000); // 转换为千亿元
                label = '阿里巴巴GMV (千亿元)';
            } else if (currentDataType === 'shopping') {
                labels = currentDataset.map(d => d.category.substring(0, 8) + '...');
                data = currentDataset.map(d => parseFloat(d.rate) * 100); // 转换为百分比
                label = '网购替代率 (%)';
            } else if (currentDataType === 'logistics') {
                labels = currentDataset.map(d => `${d.month}月`);
                data = currentDataset.map(d => parseFloat(d.companyA));
                label = '物流公司A月费用';
            } else if (currentDataType === 'car') {
                labels = currentDataset.map(d => `${d.speed}km/h`);
                data = currentDataset.map(d => parseFloat(d.distance));
                label = '制动距离 (m)';
            } else if (currentDataType === 'power') {
                labels = Array.from({length: 12}, (_, i) => `${i+1}月`);
                data = currentDataset.map(d => parseFloat(d.power2018));
                label = '2018年月发电量';
            } else {
                // 默认使用第一个文本列和第一个数值列
                const headers = Object.keys(currentDataset[0] || {});
                const textHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return isNaN(parseFloat(val)) && val !== '';
                });
                const numericHeaders = headers.filter(h => {
                    const val = currentDataset[0][h];
                    return !isNaN(parseFloat(val)) && val !== '';
                });
                
                if (textHeaders.length > 0 && numericHeaders.length > 0) {
                    labels = currentDataset.map(d => d[textHeaders[0]].substring(0, 10));
                    data = currentDataset.map(d => parseFloat(d[numericHeaders[0]]));
                    label = `${numericHeaders[0]}`;
                } else {
                    labels = currentDataset.map((_, i) => `项目${i+1}`);
                    data = currentDataset.map(d => parseFloat(Object.values(d)[0] || 0));
                    label = '数值';
                }
            }
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // 创建折线图
        function createLineChart(ctx) {
            let labels, data, label;
            
            if (currentDataType === 'mpg') {
                const yearData = {};
                currentDataset.forEach(d => {
                    if (d.year && d.cty) {
                        const year = d.year;
                        const cty = parseFloat(d.cty);
                        if (!yearData[year]) yearData[year] = [];
                        yearData[year].push(cty);
                    }
                });
                
                labels = Object.keys(yearData).sort();
                data = labels.map(year => {
                    const values = yearData[year];
                    return values.reduce((a, b) => a + b) / values.length;
                });
                label = '各年份平均城市油耗';
            } else if (currentDataType === 'usarrests') {
                const sortedData = currentDataset
                    .filter(d => d.State && d.Murder)
                    .sort((a, b) => parseFloat(a.Murder) - parseFloat(b.Murder))
                    .slice(0, 15);
                
                labels = sortedData.map(d => d.State);
                data = sortedData.map(d => parseFloat(d.Murder));
                label = '各州谋杀率 (升序排列)';
            } else {
                const sortedCities = currentDataset
                    .filter(d => d.name && d.pop)
                    .sort((a, b) => parseFloat(b.pop) - parseFloat(a.pop))
                    .slice(0, 15);
                
                labels = sortedCities.map(d => d.name.trim());
                data = sortedCities.map(d => parseFloat(d.pop) / 1000000);
                label = '人口最多的15个城市 (百万)';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>无有效数据可显示折线图</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: label,
                        data: data,
                        borderColor: colors[0],
                        backgroundColor: colors[0] + '20',
                        tension: 0.3,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // 创建饼图
        function createPieChart(ctx) {
            let labels, data;
            
            if (currentDataType === 'mpg') {
                const classCount = {};
                currentDataset.forEach(d => {
                    if (d.class) {
                        classCount[d.class] = (classCount[d.class] || 0) + 1;
                    }
                });
                labels = Object.keys(classCount);
                data = Object.values(classCount);
            } else if (currentDataType === 'usarrests') {
                labels = ['低犯罪率(<5)', '中犯罪率(5-10)', '高犯罪率(>10)'];
                const murderRates = currentDataset.map(d => parseFloat(d.Murder || 0));
                data = [
                    murderRates.filter(r => r < 5).length,
                    murderRates.filter(r => r >= 5 && r <= 10).length,
                    murderRates.filter(r => r > 10).length
                ];
            } else {
                labels = ['小城市(<50万)', '中等城市(50-100万)', '大城市(>100万)'];
                const populations = currentDataset.map(d => parseFloat(d.pop || 0));
                data = [
                    populations.filter(p => p < 500000).length,
                    populations.filter(p => p >= 500000 && p <= 1000000).length,
                    populations.filter(p => p > 1000000).length
                ];
            }
            
            currentChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length)
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            labels: { color: 'white' },
                            position: 'right'
                        }
                    }
                }
            });
        }

        // 创建直方图
        function createHistogramChart(ctx) {
            let data, label, xLabel;
            
            if (currentDataType === 'mpg') {
                data = currentDataset.map(d => parseFloat(d.cty || 0)).filter(val => !isNaN(val));
                label = '城市油耗分布';
                xLabel = '城市油耗 (mpg)';
            } else if (currentDataType === 'usarrests') {
                data = currentDataset.map(d => parseFloat(d.Murder || 0)).filter(val => !isNaN(val));
                label = '谋杀率分布';
                xLabel = '谋杀率 (每10万人)';
            } else {
                data = currentDataset.map(d => {
                    const pop = parseFloat(d.pop || 0);
                    return pop > 0 ? Math.log10(pop) : 0;
                }).filter(val => !isNaN(val));
                label = '城市人口分布 (对数尺度)';
                xLabel = '人口对数 (log10)';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>无有效数据可显示直方图</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors[0] + '80'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            offset: true,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            title: { display: true, text: xLabel, color: 'white' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            title: { display: true, text: '频数', color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // 创建雷达图
        function createRadarChart(ctx) {
            if (currentDataType !== 'usarrests') {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>雷达图最适合美国犯罪数据，请切换到USArrests数据集</strong>';
                return;
            }
            
            const states = currentDataset.slice(0, 5).filter(state => state.State);
            const labels = ['谋杀率', '袭击率', '城市人口比例', '强奸率'];
            
            if (states.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>无有效州数据可显示雷达图</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: states.map((state, i) => ({
                        label: state.State,
                        data: [
                            parseFloat(state.Murder || 0),
                            parseFloat(state.Assault || 0) / 10,
                            parseFloat(state.UrbanPop || 0),
                            parseFloat(state.Rape || 0)
                        ],
                        backgroundColor: colors[i] + '20',
                        borderColor: colors[i],
                        pointBackgroundColor: colors[i],
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: colors[i]
                    }))
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: 'rgba(255,255,255,0.2)' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            pointLabels: { color: 'white' },
                            ticks: { color: 'white', backdropColor: 'transparent' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } }
                    }
                }
            });
        }

        // 创建气泡图
        function createBubbleChart(ctx) {
            let data, label, xLabel, yLabel;
            
            if (currentDataType === 'mpg') {
                data = currentDataset.slice(0, 30).map(d => ({
                    x: parseFloat(d.displ || 0),
                    y: parseFloat(d.cty || 0),
                    r: parseFloat(d.cyl || 0) * 2
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = '排量 vs 油耗 (气泡大小表示气缸数)';
                xLabel = '排量 (L)';
                yLabel = '城市油耗 (mpg)';
            } else if (currentDataType === 'usarrests') {
                data = currentDataset.map(d => ({
                    x: parseFloat(d.Assault || 0),
                    y: parseFloat(d.Murder || 0),
                    r: parseFloat(d.UrbanPop || 0) / 5
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = '袭击率 vs 谋杀率 (气泡大小表示城市人口比例)';
                xLabel = '袭击率 (每10万人)';
                yLabel = '谋杀率 (每10万人)';
            } else {
                data = currentDataset.slice(0, 50).map(d => ({
                    x: parseFloat(d.lon || 0),
                    y: parseFloat(d.lat || 0),
                    r: Math.sqrt(parseFloat(d.pop || 1)) / 1000
                })).filter(point => !isNaN(point.x) && !isNaN(point.y) && !isNaN(point.r));
                label = '城市地理位置 (气泡大小表示人口)';
                xLabel = '经度';
                yLabel = '纬度';
            }
            
            if (data.length === 0) {
                document.getElementById('chartInfo').innerHTML = 
                    '<strong>无有效数据可显示气泡图</strong>';
                return;
            }
            
            currentChart = new Chart(ctx, {
                type: 'bubble',
                data: {
                    datasets: [{
                        label: label,
                        data: data,
                        backgroundColor: colors[0] + '80',
                        borderColor: colors[0]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            title: { display: true, text: xLabel, color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        },
                        y: { 
                            title: { display: true, text: yLabel, color: 'white' },
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: 'white' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: 'white' } },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `${label}: (${point.x.toFixed(2)}, ${point.y.toFixed(2)})`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // 初始化加载温度数据
        window.onload = function() {
            updateStatus('平台初始化完成，正在加载默认数据集...');
            loadDataset('temperature');
        };

        // 添加键盘快捷键支持
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case '1': loadDataset('temperature'); break;
                    case '2': loadDataset('alibaba'); break;
                    case '3': loadDataset('shopping'); break;
                    case '4': loadDataset('logistics'); break;
                    case '5': loadDataset('car'); break;
                    case '6': loadDataset('power'); break;
                    case '7': loadDataset('holland'); break;
                    case '8': loadDataset('biomass'); break;
                }
            }
        });
    </script>
</body>
</html>